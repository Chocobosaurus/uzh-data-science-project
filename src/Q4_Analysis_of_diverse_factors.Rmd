

```{r question 4}
library(dplyr)
library(readr)
library(ggplot2)

reisende <- read.csv("~/Desktop/reisende.csv", sep = ";")

reisende_data <- reisende %>% 
  mutate(day_type = ifelse(Tage_DWV > 0, "Weekday", "Weekend"),
         academic_calendar = case_when(
           Tagtyp_Id %in% c(10, 11, 12) ~ "Exam Session",
           Tagtyp_Id %in% c(8, 9) ~ "Semester Break",
           TRUE ~ "Lecture Period"
         ),
         passenger_count = Besetzung, data = reisende)

# Factor analysis for weekday versus weekend patterns
weekday_vs_weekend <- reisende_data %>%
    group_by(day_type) %>%
    mutate(avg_passengers = Besetzung) %>%
    distinct() %>%
    summarise(avg_passengers = mean(avg_passengers, na.rm = TRUE))

# Factor analysis for academic calendar
semester_vs_break <- reisende_data %>%
    group_by(academic_calendar) %>%
    mutate(avg_passengers = Besetzung) %>%
    distinct() %>%
    summarise(avg_passengers = mean(avg_passengers, na.rm = TRUE))

# Plotting the difference between weekday and weekend passenger counts
barplot(weekday_vs_weekend$avg_passengers, names.arg = weekday_vs_weekend$day_type,
        main = "Average Occupation: Weekday vs. Weekend",
        xlab = "Day Type", ylab = "Average Occupation")

# Plotting the difference between academic and non-academic periods
barplot(semester_vs_break$avg_passengers, names.arg = semester_vs_break$academic_calendar,
        main = "Average Occupation: Academic Calendar",
        xlab = "Academic Calendar", ylab = "Average Occupation")

# Filter out rows with zero or negative passenger counts
reisende_data <- reisende_data %>%
  filter(passenger_count > 0)

# Create boxplot for weekday vs. weekend passenger counts
weekday_vs_weekend_boxplot <- ggplot(reisende_data, aes(x = day_type, y = passenger_count, fill = day_type)) +
  geom_boxplot() +
  labs(title = "Distribution of Occupation: Weekday vs. Weekend",
       x = "Day Type", y = "Occupation") +
  theme_minimal() +
  scale_y_log10(labels = function(x) {
    ifelse(x < 1, format(x, scientific = FALSE), format(x, scientific = FALSE, digits = 2))
  })  # Use log scale for y-axis and customize label formatting

# Create boxplot for academic calendar
semester_vs_break_boxplot <- ggplot(reisende_data, aes(x = academic_calendar, y = passenger_count, fill = academic_calendar)) +
  geom_boxplot() +
  labs(title = "Distribution of Occupation: Academic Calendar",
       x = "Academic Calendar", y = "Occupation") +
  theme_minimal() +
  scale_y_log10(labels = function(x) {
    ifelse(x < 1, format(x, scientific = FALSE), format(x, scientific = FALSE, digits = 2))
  })  # Use log scale for y-axis and customize label formatting


# Display the plots
print(weekday_vs_weekend_boxplot)
print(semester_vs_break_boxplot)

# Now the following part is to analyse the passenger occupation near the universities during exam session, lecture period, and semester break. Stops "Zürich, ETH/Universitätsspital", "Zürich, ETH Hönggerberg", "Zürich, Milchbuck", Zürich, Universität Irchel" are chosen.

reisende <- read.csv("~/Desktop/reisende.csv", sep = ";")

# Filter stops near universities
university_stops <- c(60, 377, 53, 161)
reisende_filtered <- reisende %>% 
  filter(Haltestellen_Id %in% university_stops)

# Rerun the analysis
reisende_data_filtered <- reisende_filtered %>% 
  mutate(day_type = ifelse(Tage_DWV > 0, "Weekday", "Weekend"),
         academic_calendar = case_when(
           Tagtyp_Id %in% c(10, 11, 12) ~ "Exam Session",
           Tagtyp_Id %in% c(8, 9) ~ "Semester Break",
           TRUE ~ "Lecture Period"
         ),
         passenger_count = Besetzung)

# Factor analysis for academic calendar
semester_vs_break_filtered <- reisende_data_filtered %>%
    group_by(academic_calendar) %>%
    mutate(avg_passengers = Besetzung) %>%
    distinct() %>%
    summarise(avg_passengers = mean(avg_passengers, na.rm = TRUE))

# Plotting the difference between academic and non-academic periods
barplot(semester_vs_break_filtered$avg_passengers, names.arg = semester_vs_break_filtered$academic_calendar,
        main = "Average Occupation: Academic Calendar",
        xlab = "Academic Calendar", ylab = "Average Occupation")

# Filter out rows with zero or negative passenger counts
reisende_data_filtered <- reisende_data_filtered %>%
  filter(passenger_count > 0)

# Create boxplot for academic calendar
semester_vs_break_boxplot_filtered <- ggplot(reisende_data_filtered, aes(x = academic_calendar, y = passenger_count, fill = academic_calendar)) +
  geom_boxplot() +
  labs(title = "Distribution of Occupation: Academic Calendar",
       x = "Academic Calendar", y = "Occupation") +
  theme_minimal() +
  scale_y_log10(labels = function(x) {
    ifelse(x < 1, format(x, scientific = FALSE), format(x, scientific = FALSE, digits = 2))
  })  # Use log scale for y-axis and customize label formatting

# Display the plots
print(semester_vs_break_boxplot_filtered)

reisende_data$dataset <- factor("All Routes", levels = c("All Routes", "University Stops"))
reisende_data_filtered$dataset <- factor("University Stops", levels = c("All Routes", "University Stops"))

# Combine the datasets for plotting
combined_boxplot <- ggplot() +
  geom_boxplot(data = reisende_data, aes(x = academic_calendar, y = passenger_count, fill = academic_calendar)) +
  geom_boxplot(data = reisende_data_filtered, aes(x = academic_calendar, y = passenger_count, fill = academic_calendar)) +
  facet_wrap(~ dataset, scales = "free_y") +  # Facet by dataset (all routes vs. university stops)
  labs(title = "Distribution of Occupation: Academic Calendar",
       x = "Academic Calendar", y = "Occupation") +
  theme_minimal() +
  scale_y_log10(labels = function(x) {
    ifelse(x < 1, format(x, scientific = FALSE), format(x, scientific = FALSE, digits = 2))
  }) + # Use log scale for y-axis and customize label formatting
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

# Display the plot
print(combined_boxplot)

```
